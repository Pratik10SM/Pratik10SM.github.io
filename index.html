<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Magic Number Trick by Pratik Patil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    .container { max-width: 440px; margin: 40px auto; background: #fff; border-radius: 9px; box-shadow: 0 2px 8px #0002; padding: 32px 24px; }
    h1 { text-align: center; color: #1e88e5; }
    .btn { padding: 10px 20px; background: #1e88e5; color: #fff; border: none; border-radius: 4px; margin: 6px 4px; cursor: pointer; font-size: 16px; }
    .btn:disabled { background: #b0bec5; }
    .input-row { margin: 18px 0 10px; }
    input[type="number"] { font-size: 18px; padding: 7px 10px; width: 80%; border: 1px solid #ccc; border-radius: 4px;}
    .result, .instructions { margin: 18px 0; padding: 12px; background: #e3f2fd; border-radius: 4px; min-height: 40px; }
    .result.success { background: #d0ffdc; color: #389e59; }
    .result.fail { background: #ffd0d0; color: #c62828; }
    .fade { animation: fadeIn 0.7s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .trick-btns { text-align: center; margin-bottom: 20px; }
    #numbersList { background: #fffbe9; color: #7a5e13; margin: 14px 0 0 0; padding: 10px 12px; border-radius: 4px; font-size: 17px; min-height: 20px; border: 1px solid #ffe082; }
    @media (max-width: 600px) { .container { padding: 12px 4px; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Magic Number Trick</h1>
    <div class="trick-btns">
      <button class="btn" id="startTrickBtn">Start Trick</button>
      <button class="btn" id="resetBtn" style="display:none;">Reset</button>
    </div>
    <div class="instructions" id="instructions">
      Click "Start Trick" to begin.<br><br>
      <strong>Instructions:</strong>
      <ul>
        <li>Your <b>first number</b> should be a <b>three-digit number</b> whose <b>first digit is not 0 or 1</b>.</li>
        <li>All <b>subsequent numbers</b> you enter should also be <b>three-digit numbers</b>.</li>
      </ul>
    </div>
    <div class="input-row" id="inputRow" style="display:none;">
      <input type="number" id="userInput" placeholder="Enter three-digit number" />
      <button class="btn" id="submitBtn">Submit</button>
    </div>
    <div id="numbersList"></div>
    <div class="result" id="result"></div>
  </div>
  <script>
    // State
    let step = 0;
    let trickNumbers = [];
    let turnLabels = []; // To track whose turn for display

    const MAGIC_NUMBER = 2571;

    const startTrickBtn = document.getElementById('startTrickBtn');
    const resetBtn = document.getElementById('resetBtn');
    const instructions = document.getElementById('instructions');
    const inputRow = document.getElementById('inputRow');
    const userInput = document.getElementById('userInput');
    const submitBtn = document.getElementById('submitBtn');
    const result = document.getElementById('result');
    const numbersList = document.getElementById('numbersList');

    function showInstructions(text) {
      instructions.innerHTML = text;
      instructions.classList.add('fade');
      setTimeout(() => instructions.classList.remove('fade'), 650);
    }

    function showResult(text, status) {
      result.innerHTML = text;
      result.className = 'result fade' + (status ? ' success' : ' fail');
      setTimeout(() => result.classList.remove('fade'), 650);
    }

    function resetAll() {
      step = 0;
      trickNumbers = [];
      turnLabels = [];
      userInput.value = '';
      userInput.disabled = false;
      inputRow.style.display = 'none';
      submitBtn.disabled = false;
      showInstructions(
        'Click "Start Trick" to begin.<br><br>' +
        '<strong>Instructions:</strong>' +
        '<ul>' +
        '<li>Your <b>first number</b> should be a <b>three-digit number</b> whose <b>first digit is not 0 or 1</b>.</li>' +
        '<li>All <b>subsequent numbers</b> you enter should also be <b>three-digit numbers</b>.</li>' +
        '</ul>'
      );
      result.innerHTML = '';
      numbersList.innerHTML = '';
      resetBtn.style.display = 'none';
      startTrickBtn.disabled = false;
    }

    function renderNumbersList() {
      if (trickNumbers.length === 0) {
        numbersList.innerHTML = '';
        return;
      }
      let html = '<b>Numbers so far:</b><br><ul style="margin:8px 0 0 18px;padding:0;">';
      for (let i = 0; i < trickNumbers.length; i++) {
        html += `<li>${turnLabels[i]}: <b>${trickNumbers[i]}</b></li>`;
      }
      html += '</ul>';
      numbersList.innerHTML = html;
    }

    function openCalculationPage() {
      let html = `
        <html>
        <head>
          <title>Magic Number Calculation</title>
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <style>
            body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
            .calculation-box { max-width: 440px; margin: 40px auto; background: #fff; border-radius: 9px; box-shadow: 0 2px 8px #0002; padding: 32px 24px; }
            h2 { color: #1e88e5; text-align: center; }
            .magic { background: #d0ffdc; color: #389e59; border-radius: 4px; padding: 14px; margin-top: 28px; font-size: 18px; text-align:center;}
            ul { font-size: 18px; margin: 15px 0 15px 18px;}
            .sum { font-size: 19px; color: #c62828; font-weight: bold; margin-top: 12px;}
            .explain { margin: 22px 0 0 0; color: #444; font-size: 16px; }
            .btn { padding: 10px 20px; background: #1e88e5; color: #fff; border: none; border-radius: 4px; margin: 22px auto 0 auto; display:block; font-size: 16px; cursor:pointer;}
          </style>
        </head>
        <body>
          <div class="calculation-box">
            <h2>Magic Number Calculation</h2>
            <ul>
      `;
      for (let i = 0; i < trickNumbers.length; i++) {
        html += `<li>${turnLabels[i]}: <b>${trickNumbers[i]}</b></li>`;
      }
      let total = trickNumbers.reduce((a, b) => a + b, 0);
      html += `
            </ul>
            <div class="sum">Sum = ${trickNumbers.join(' + ')} = <b>${total}</b></div>
            <div class="magic">
              Prediction: <b>${MAGIC_NUMBER}</b><br>
              ${total === MAGIC_NUMBER ? 'üéâ The magic worked! üéâ' : '‚ùå Try again! ‚ùå'}
            </div>
            <div class="explain">
              <b>How it works:</b> The bot's numbers are always chosen so that the total adds up to ${MAGIC_NUMBER}, no matter what numbers you pick!
            </div>
            <button class="btn" onclick="window.close()">Close</button>
          </div>
        </body>
        </html>
      `;
      let win = window.open("", "_blank");
      win.document.write(html);
      win.document.close();
    }

    // Bot's number logic: keep absolute value, and ensure unit digit is NOT 0 or 1, and stays in 3-digit range
    function getValidBotNumber(target) {
      let num = Math.abs(target);

      // Clamp to 3-digit range
      if (num < 100) num = 100;
      if (num > 999) num = 999;

      // Adjust to avoid 0 or 1 at unit digit
      let tries = 0;
      while ((num % 10 === 0 || num % 10 === 1) && tries < 20) {
        // Try incrementing, but don't go out of range
        if (num < 999) num++;
        else if (num > 100) num--;
        else num = 102; // fallback
        tries++;
      }
      return num;
    }

    // Magic Number Trick Logic
    function startTrick() {
      step = 0;
      trickNumbers = [];
      turnLabels = [];
      showInstructions(
        'Enter your <b>first three-digit number</b> (first digit must not be 0 or 1):'
      );
      inputRow.style.display = 'block';
      result.innerHTML = '';
      numbersList.innerHTML = '';
      userInput.value = '';
      resetBtn.style.display = '';
      startTrickBtn.disabled = true;
    }

    function handleTrickInput() {
      const val = parseInt(userInput.value, 10);
      // Validation
      if (isNaN(val) || val < 100 || val > 999) {
        alert('Please enter a valid three-digit number.');
        return;
      }
      const firstDigit = Math.floor(val / 100);
      // Step 1: User enters first number
      if (step === 0) {
        if (firstDigit === 0 || firstDigit === 1) {
          alert('The first digit must not be 0 or 1. Please enter a valid three-digit number.');
          return;
        }
        trickNumbers.push(val);
        turnLabels.push("You");
        const firstBotNum = getValidBotNumber(MAGIC_NUMBER - val);
        trickNumbers.push(firstBotNum);
        turnLabels.push("Bot");
        showInstructions(
          `Bot enters: ${firstBotNum}<br>Now, enter your <b>second three-digit number</b>:`
        );
        userInput.value = '';
        step++;
      }
      // Step 2: User enters second number
      else if (step === 1) {
        trickNumbers.push(val);
        turnLabels.push("You");
        const secondBotNum = getValidBotNumber(MAGIC_NUMBER - trickNumbers.reduce((a, b) => a + b, 0));
        trickNumbers.push(secondBotNum);
        turnLabels.push("Bot");
        showInstructions(
          `Bot enters: ${secondBotNum}<br>Now, enter your <b>third and final three-digit number</b>:`
        );
        userInput.value = '';
        step++;
      }
      // Step 3: User enters third number
      else if (step === 2) {
        trickNumbers.push(val);
        turnLabels.push("You");
        const sum = trickNumbers.reduce((a, b) => a + b, 0);
        showResult(
          `Numbers: ${trickNumbers.join(', ')}<br>Sum: ${sum}<br>Prediction: ${MAGIC_NUMBER}<br>${sum === MAGIC_NUMBER ? '‚úÖ Magic!' : '‚ùå Try again!'}`,
          sum === MAGIC_NUMBER
        );
        showInstructions('Trick Complete! See the calculation below.');
        inputRow.style.display = 'none';
        renderNumbersList();
        setTimeout(openCalculationPage, 1200);
        return;
      }
      renderNumbersList();
      userInput.value = '';
    }

    // Event Listeners
    startTrickBtn.onclick = startTrick;
    resetBtn.onclick = resetAll;
    submitBtn.onclick = handleTrickInput;
    userInput.addEventListener("keyup", function(event) {
      if (event.key === "Enter") submitBtn.click();
    });

    // Initial State
    resetAll();
  </script>
</body>
</html>
